### Send a command to all nodes in cluster (defined by cluster file)
### Key file is provided by AWS when setting up node

identity_file="403.pem"

for server in $(cat cluster); do
    echo $server
    scp -i $identity_file ./DHT2.py ec2-user@$server:~/    
    scp -i $identity_file ./config.txt ec2-user@$server:~/
    echo "file send"
    ssh -i $identity_file ec2-user@$server "sudo yum install python36x"
done
echo "Done"
for server in $(cat cluster); do
    ssh -i $identity_file ec2-user@$server "while pgrep python3 > /dev/null; do sleep 1; done; cat out.txt"
done
echo "printed"
